<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ISBN Sales Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Poppins:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      .poppins {
        font-family: "Poppins", sans-serif;
      }
      body {
        font-family: "Open Sans", sans-serif;
        color: #000;
        padding: 0;
        margin: 0;
      }
      [data-title]:hover::after {
        content: attr(data-title);
        font-family: "Open Sans", sans-serif;
        background-color: #ffc451;
        color: #000;
        padding: 0.7rem;
        width: 200px;
        position: absolute;
        z-index: 1000;
        line-height: 121%;
        font-size: 0.65rem;
        border-radius: 0.5rem;
        transform: translateX(0.5rem) translateY(-50%);
      }

      @media (max-width: 480px) {
        [data-title]:hover::after {
          right: 0;
          transform: translateX(-50%) translateY(-50%);
          left: 50%;
        }
      }
    </style>
  </head>
  <body>
    <div class="flex flex-col items-center justify-center w-full">
      <div class="w-[90%] sm:w-[80%] mt-2">
        <h2
          class="poppins my-4 text-[1.4rem] sm:text-[1.9rem] font-semibold text-[#FFC451]"
        >
          Buch-Wert-Rechner
        </h2>
        <p
          class="poppins my-6 text-[0.9rem] sm:text-[1rem] text-[#303030] leading-[121%] sm:text-justify text-left"
        >
          Mit unserem Buch-Wert-Rechner kannst Du ganz einfach den ungefähren
          Wert Deines Buchprojekts berechnen. Basierend auf dem Buchtyp, dem
          durchschnittlichen Verkaufspreis, den Gewinnen und der Dauer der
          regelmäßigen Einnahmen, zeigt Dir unser Tool den geschätzten Wert in
          Euro an. Gib einfach die entsprechenden Werte in die Felder ein, und
          unser Tool berechnet den Wert interaktiv und sofort. Beachte bitte,
          dass das Ergebnis lediglich einen Schätzwert zur Orientierung
          darstellt. Der tatsächliche Wert kann von verschiedenen Faktoren
          abhängen, einschließlich Marktbedingungen und individuellen
          Verkaufsstrategien. Falls Du spezielle Wünsche hast, Fehler entdeckst
          oder sonstige Anliegen hast, zögere bitte nicht, uns zu kontaktieren.
          Wir sind stets bemüht, unsere Tools zu verbessern und Deine
          Bedürfnisse bestmöglich zu erfüllen. Nutze hierfür bitte unser
          <a
            href="https://ghostwritery.de/kontakt/"
            class="text-[#FFC451] hover:underline"
            >Kontaktformular</a
          >. Wir freuen uns auf Deine Nachricht!
        </p>
      </div>
    </div>

    <!-- Section: ISBN Input and Book Image -->
    <div class="container mx-auto p-6 lg:p-12 w-screen">
      <div class="flex w-full flex-col items-center justify-center -mx-4">
        <!-- ISBN Input and Book Image -->
        <section class="w-full lg:w-[30%] p-4" id="searchBox">
          <div class="bg-white rounded-lg p-6 h-full shadow-md">
            <h2 class="text-xl font-semibold mb-4">Enter ISBN</h2>
            <input
              type="text"
              id="isbn_input"
              class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#FFC451]"
              placeholder="Enter 10-digit ISBN number"
              maxlength="10"
            />
            <p id="warn" class="text-red-500 text-sm mt-2"></p>
            <button
              onclick="calculateDetails()"
              id="CalculateDetails"
              class="w-full mt-4 py-3 bg-[#FFC451] hover:bg-[#fff] text-white hover:text-[#FFC451] border-2 !border-[#FFC451] font-semibold rounded-lg transition duration-300 disabled:opacity-75"
            >
              Get Details
            </button>
          </div>
        </section>

        <section class="w-full lg:w-[30%] p-4 flex justify-center hidden" id="loaderBox">
          <img src="Animation - 1722624059186.gif" alt="Loading..." />
        </section>

        <section class="w-full p-4 hidden" id="resultBox">
          <div
            class="flex flex-col lg:flex-row gap-5 justify-center items-stretch p-6 h-full"
          >
            <div
              class="bg-gray-50 flex flex-col justify-center rounded-lg w-full lg:w-1/2 p-4 shadow-md"
            >
              <h2 class="text-xl font-semibold mb-4">Estimated Sales</h2>
              <table class="w-full table-auto">
                <thead>
                  <tr class="border-gray-200">
                    <th
                      class="px-4 py-3 text-[1rem] font-medium text-start font-semibold"
                    >
                      Book Type
                    </th>
                    <th class="px-4 py-3 text-[1rem] font-medium font-semibold">
                      Daily Sales
                    </th>
                    <th class="px-4 py-3 text-[1rem] font-medium font-semibold">
                      Monthly Sales
                    </th>
                  </tr>
                </thead>
                <tbody class="tbodySale"></tbody>
              </table>
            </div>

            <div
              class="bg-gray-50 rounded-lg w-full lg:w-1/2 p-4 shadow-md flex flex-col justify-center"
            >
              <h2 class="text-xl font-semibold mb-4">Estimated Revenue</h2>
              <table class="w-full table-auto">
                <thead>
                  <tr class="border-gray-200">
                    <th
                      class="px-4 py-3 text-[1rem] font-medium text-start font-semibold"
                    >
                      Book Type
                    </th>
                    <th class="px-4 py-3 text-[1rem] font-medium font-semibold">
                      Daily Revenue
                    </th>
                    <th class="px-4 py-3 text-[1rem] font-medium font-semibold">
                      Monthly Revenue
                    </th>
                  </tr>
                </thead>
                <tbody class="tbodyRev"></tbody>
              </table>
            </div>
          </div>
        </section>
      </div>
    </div>
    <div class="flex flex-col items-center justify-center w-full">
      <div class="w-[90%] md:w-[80%] mt-2 mb-5">
        <h2
          class="poppins my-4 text-[1.3rem] sm:text-[1.5rem] font-semibold text-[#FFC451]"
        >
          Beispiel zur Nutzung des Tools „Konkurrenzanalyse"
        </h2>
        <p
          class="poppins my-6 text-[0.9rem] sm:text-[1rem] text-[#303030] leading-[121%] sm:text-justify text-left"
        >
          Um das Tool optimal zu nutzen, folge diesen Schritten:
        </p>
        <h3
          class="poppins my-4 text-[1.3rem] sm:text-[1.5rem] font-semibold text-[#FFC451]"
        >
          Schritte zur Nutzung:
        </h3>
        <ul class="ml-5 list-decimal poppins text-[0.9rem]">
          <li class="leading-[121%] py-1">
            <b>Bestseller-Rang eingeben:</b> Trage den aktuellen Bestseller-Rang
            des Konkurrenzbuches auf Amazon in das entsprechende Feld ein. Den
            Bestseller-Rang findest Du auf der Produktseite des Buches unter den
            Produktdetails.
          </li>
          <li class="leading-[121%] py-1">
            <b>Buchtyp auswählen:</b> Nutze das Dropdown-Menü, um den Typ des
            Konkurrenzbuches festzulegen. Die Optionen sind „eBook“,
            „Taschenbuch“ und „Hardcover“.
          </li>
          <li class="leading-[121%] py-1">
            <b>Berechnen:</b> Klicke auf den „Berechnen“-Button, um die
            geschätzten Verkaufszahlen zu erhalten.
          </li>
          <li class="leading-[121%] py-1">
            <b>Ergebnisse beobachten:</b> Das Tool zeigt Dir automatisch die
            geschätzten Verkaufszahlen pro Tag und pro Monat an, basierend auf
            Deinen Eingaben.
          </li>
        </ul>
        <h3
          class="poppins my-4 text-[1.3rem] sm:text-[1.5rem] font-semibold text-[#FFC451]"
        >
          Hinweise:
        </h3>
        <ul class="ml-5 list-decimal poppins text-[0.9rem]">
          <li class="leading-[121%] py-1">
            Die angezeigten Werte sind Schätzwerte und dienen lediglich zur
            Orientierung.
          </li>
        </ul>
        <p
          class="poppins my-6 text-[0.9rem] sm:text-[1rem] text-[#303030] leading-[121%] sm:text-justify text-left"
        >
          Falls Du spezielle Wünsche hast, Fehler entdeckst oder sonstige
          Anliegen hast, zögere bitte nicht, uns zu kontaktieren. Wir sind stets
          bemüht, unsere Tools zu verbessern und Deine Bedürfnisse bestmöglich
          zu erfüllen. Nutze hierfür bitte unser Kontaktformular. Wir freuen uns
          auf Deine Nachricht!
        </p>

        <h2
          class="poppins my-4 text-[1.3rem] sm:text-[1.5rem] font-semibold text-[#FFC451]"
        >
          Dankeschön
        </h2>
        <p
          class="poppins my-6 text-[0.9rem] sm:text-[1rem] text-[#303030] leading-[121%] sm:text-justify text-left"
        >
          Wir möchten uns herzlich bei allen Kunden bedanken, die bei der
          Erstellung dieses Tools mitgewirkt haben. Eure wertvollen
          Rückmeldungen und Anregungen haben uns geholfen, dieses Werkzeug noch
          besser auf Eure Bedürfnisse abzustimmen. Vielen Dank für Eure
          Unterstützung und das Vertrauen in unsere Dienstleistungen!
        </p>
      </div>
    </div>
    <script src="https://unpkg.com/axios@1.6.7/dist/axios.min.js"></script>
    <script>
      const CALCULATE_BUTTON = document.getElementById("CalculateDetails");
      const WARNING_TEXT = document.getElementById("warn");
      const ISBN_INPUT = document.getElementById("isbn_input");
      const TBODY_REV = document.querySelector(".tbodyRev");
      const TBODY_SALE = document.querySelector(".tbodySale");
      // const DUMMY_REVENUE = document.querySelectorAll(".dummyRevenue");
      const RESULT_DAILY = document.querySelector("#result-daily");
      const RESULT_MONTHLY = document.querySelector("#result-monthly");
      const RESULT_BOX = document.getElementById("resultBox");
      const LOADER_BOX = document.getElementById("loaderBox");
      const SEARCH_BOX = document.getElementById("searchBox");

      const toggleVisibility = (element, show) => {
        if (!element) {
          console.error("Element not found");
          return;
        }
        if (show) {
          if (element.classList.contains("hidden")) {
            element.classList.remove("hidden");
          }
        } else {
          if (!element.classList.contains("hidden")) {
            element.classList.add("hidden");
          }
        }
      };

      const showLoader = () => toggleVisibility(LOADER_BOX, true);
      const hideLoader = () => toggleVisibility(LOADER_BOX, false);
      const showResultBox = () => toggleVisibility(RESULT_BOX, true);
      const hideResultBox = () => toggleVisibility(RESULT_BOX, false);
      const showSearchBox = () => toggleVisibility(SEARCH_BOX, true);
      const hideSearchBox = () => toggleVisibility(SEARCH_BOX, false);

      const enableButton = () => {
        CALCULATE_BUTTON.textContent = "Get Details";
        CALCULATE_BUTTON.disabled = false;
        CALCULATE_BUTTON.classList.add(
          "hover:bg-[#fff]",
          "hover:text-[#FFC451]"
        );
      };

      const disableButton = () => {
        CALCULATE_BUTTON.disabled = true;
        CALCULATE_BUTTON.textContent = "Calculating...";
        CALCULATE_BUTTON.classList.remove(
          "hover:bg-[#fff]",
          "hover:text-[#FFC451]"
        );
      };

      const calculateSellingAmountPerDay = (sellerRank) => {
        let sellingAmountPerDay = 0;
        if (sellerRank >= 1 && sellerRank <= 5)
          sellingAmountPerDay = Math.round(
            ((230 - 370) / 4) * (sellerRank - 1) + 370
          );
        else if (sellerRank >= 6 && sellerRank <= 10)
          sellingAmountPerDay = Math.round(
            ((180 - 230) / 5) * (sellerRank - 5) + 230
          );
        else if (sellerRank >= 11 && sellerRank <= 20)
          sellingAmountPerDay = Math.round(
            ((120 - 180) / 10) * (sellerRank - 10) + 180
          );
        else if (sellerRank >= 21 && sellerRank <= 35)
          sellingAmountPerDay = Math.round(
            ((90 - 120) / 15) * (sellerRank - 20) + 120
          );
        else if (sellerRank >= 36 && sellerRank <= 50)
          sellingAmountPerDay = Math.round(
            ((80 - 90) / 15) * (sellerRank - 35) + 90
          );
        else if (sellerRank >= 51 && sellerRank <= 100)
          sellingAmountPerDay = Math.round(
            ((50 - 80) / 50) * (sellerRank - 50) + 80
          );
        else if (sellerRank >= 101 && sellerRank <= 200)
          sellingAmountPerDay = Math.round(
            ((33 - 50) / 100) * (sellerRank - 100) + 50
          );
        else if (sellerRank >= 201 && sellerRank <= 500)
          sellingAmountPerDay = Math.round(
            ((20 - 33) / 300) * (sellerRank - 200) + 33
          );
        else if (sellerRank >= 501 && sellerRank <= 1000)
          sellingAmountPerDay = Math.round(
            ((13 - 20) / 500) * (sellerRank - 500) + 20
          );
        else if (sellerRank >= 1001 && sellerRank <= 5000)
          sellingAmountPerDay = Math.round(
            ((5 - 13) / 4000) * (sellerRank - 1000) + 13
          );
        else if (sellerRank >= 5001 && sellerRank <= 10000)
          sellingAmountPerDay = Math.round(
            ((3 - 5) / 5000) * (sellerRank - 5000) + 5
          );
        else if (sellerRank >= 10001 && sellerRank <= 50000)
          sellingAmountPerDay = Math.round(
            ((1 - 3) / 40000) * (sellerRank - 10000) + 3
          );
        else if (sellerRank >= 50001 && sellerRank <= 100000)
          sellingAmountPerDay = Math.round(
            ((1 - 1) / 50000) * (sellerRank - 50000) + 1
          );
        else if (sellerRank > 100000) sellingAmountPerDay = "No Sales";
        return sellingAmountPerDay;
      };

      const getAllBookIds = (doc) => {
        const typesButtons = doc.querySelectorAll(
          ".a-button-toggle .a-button-inner a"
        );
        const bookIds = [];
        typesButtons.forEach((button) => {
          const href = button.getAttribute("href");
          if (href && !href.includes("javascript:void(0)")) {
            const match = href.match(/\/dp\/([A-Z0-9]{10})/);
            if (match) {
              bookIds.push(match[1]);
            }
          }
        });
        return bookIds;
      };

      const getSelectedType = (doc) => {
        let selectedType = doc.querySelector(
          ".a-button-selected .a-button-inner .a-button-text .slot-title"
        );
        let bookType = selectedType ? selectedType.textContent.trim() : "";
        return bookType;
      };

      const getBookPrice = (doc) => {
        let bookPrice = doc.querySelector(".a-color-price").innerText;
        bookPrice = bookPrice.replace(",", ".").replace("€", "").trim();
        return bookPrice;
      };
      const getSellerLevel = (targetPageCode) => {
        let rankMatch = targetPageCode.match(
          /Amazon Bestseller-Rang: <\/span> Nr\. ([\d.,]+) /
        );
        // console.log(rankMatch);
        // let rankMatch = doc.querySelector("span:contains('Amazon Bestseller-Rang')");
        if (rankMatch) {
          return rankMatch[1].replace(".", "");
        }
        return null;
      };

      const fetchPage = async (url) => {
        try {
          const response = await axios.get(url);
          if (response.status !== 200)
            throw new Error("Network response was not ok.");
          return response.data;
        } catch (error) {
          console.error("Error fetching the page:", error);
          WARNING_TEXT.textContent =
            "An error occurred while fetching the page.";
        }
      };

      const fetchBookDetails = async (bookId) => {
        const url = `https://makis.world/amazon/dp/${bookId}`;
        console.log("Fetching book details for book ID:", bookId);
        const targetPageCode = await fetchPage(url);
        if (!targetPageCode) return null;

        const parser = new DOMParser();
        const doc = parser.parseFromString(targetPageCode, "text/html");

        const bookType = getSelectedType(doc);
        let bookPrice = getBookPrice(doc);
        bookPrice = parseFloat(bookPrice); // Convert bookPrice to a number
        const sellerLevel = getSellerLevel(targetPageCode);
        const sellingAmountPerDay = calculateSellingAmountPerDay(sellerLevel);
        let sellingAmountPerMonth = 0;
        if (sellingAmountPerDay !== "No Sales") {
          sellingAmountPerMonth = sellingAmountPerDay * 30;
        } else {
          sellingAmountPerMonth = "No Sales";
        }
        let dailyRevenue = 0;
        let monthlyRevenue = 0;
        if (
          !isNaN(bookPrice) &&
          sellingAmountPerDay !== "No Sales" &&
          !isNaN(sellingAmountPerMonth)
        ) {
          dailyRevenue = Math.round(bookPrice * sellingAmountPerDay);
          monthlyRevenue = Math.round(bookPrice * sellingAmountPerMonth);
        }

        return {
          bookId,
          bookType,
          bookPrice,
          sellerLevel,
          sellingAmountPerDay,
          sellingAmountPerMonth,
          dailyRevenue,
          monthlyRevenue,
        };
      };

      const calculateDetails = async () => {
        TBODY_REV.innerHTML = "";
        TBODY_SALE.innerHTML = "";
        disableButton();
        hideResultBox();
        hideSearchBox();
        showLoader();
        WARNING_TEXT.textContent = "";
        const isbn = ISBN_INPUT.value.trim();
        if (isbn.length !== 10) {
          WARNING_TEXT.textContent = "ISBN must be 10 digits.";
          enableButton();
          return;
        }

        const firstBookDetails = await fetchBookDetails(isbn);
        if (!firstBookDetails) {
          WARNING_TEXT.textContent =
            "Failed to fetch details. Please check the ISBN and try again.";
          enableButton();
          return;
        }

        const url = `https://makis.world/amazon/dp/${isbn}`;
        const targetPageCode = await fetchPage(url);
        const parser = new DOMParser();
        const doc = parser.parseFromString(targetPageCode, "text/html");

        const remainingBookIds = getAllBookIds(doc);
        let remainingBookDetails = [];
        let totalDailySales = 0;
        let totalMonthlySales = 0;
        let totalDailyRevenue = 0;
        let totalMonthlyRevenue = 0;
        let remainingBookDetailsLength = remainingBookIds.length;
        if (
          firstBookDetails.sellingAmountPerDay !== "No Sales" &&
          !isNaN(firstBookDetails.sellingAmountPerMonth)
        ) {
          totalDailySales += firstBookDetails.sellingAmountPerDay;
          totalMonthlySales += firstBookDetails.sellingAmountPerMonth;
          totalDailyRevenue += firstBookDetails.dailyRevenue;
          totalMonthlyRevenue += firstBookDetails.monthlyRevenue;
        }
        while (remainingBookDetailsLength > 0) {
          remainingBookDetailsLength--;
          const bookDetails = await fetchBookDetails(
            remainingBookIds[remainingBookDetailsLength]
          );
          if (bookDetails) {
            remainingBookDetails.push(bookDetails);
            if (
              bookDetails.sellingAmountPerDay !== "No Sales" &&
              !isNaN(bookDetails.sellingAmountPerMonth)
            ) {
              totalDailySales += bookDetails.sellingAmountPerDay;
              totalMonthlySales += bookDetails.sellingAmountPerMonth;
              totalDailyRevenue += bookDetails.dailyRevenue;
              totalMonthlyRevenue += bookDetails.monthlyRevenue;
            }
          }
        }

        const allBooksData = [firstBookDetails, ...remainingBookDetails];
        console.log(allBooksData);
        let allBookLength = allBooksData.length;
        while (allBookLength > 0) {
          allBookLength--; // Decrement before accessing the array elements
          let rowSale = `
    <tr class="border-gray-200">
      <td class="px-4 py-3 text-[1rem] font-medium">${allBooksData[allBookLength].bookType}</td>
   
      <td class="px-4 py-3 text-[1rem] text-center">
        <span class="revenue-kindle-monthly">${allBooksData[allBookLength].sellingAmountPerDay}</span>
      </td>
      <td class="px-4 py-3 text-[1rem] text-center">
        <span class="revenue-kindle-monthly">${allBooksData[allBookLength].sellingAmountPerMonth}</span>
      </td>
    </tr>
    
  `;
          TBODY_SALE.innerHTML += rowSale;
          let rowRev = `
    <tr class="border-gray-200">
      <td class="px-4 py-3 text-[1rem] font-medium">${allBooksData[allBookLength].bookType}</td>
  
      <td class="px-4 py-3 text-[1rem] text-center">
        <span class="revenue-kindle-monthly">${allBooksData[allBookLength].dailyRevenue}</span>€
      </td>
      <td class="px-4 py-3 text-[1rem] text-center">
        <span class="revenue-kindle-monthly">${allBooksData[allBookLength].monthlyRevenue}</span>€
      </td>

  `;
          TBODY_REV.innerHTML += rowRev;
        }
        TBODY_SALE.innerHTML += `
    </tr>
           <tr class="border-gray-200">
      <td class="px-4 py-3 text-[1rem] font-semibold">Total</td>
   
      <td class="px-4 py-3 text-[1rem] text-center">
        <span class="revenue-kindle-monthly font-semibold">${totalDailySales}</span>
      </td>
      <td class="px-4 py-3 text-[1rem] text-center">
        <span class="revenue-kindle-monthly font-semibold">${totalMonthlySales}</span>
      </td>
    </tr>
  `;
        TBODY_REV.innerHTML += `
    </tr>
           <tr class="border-gray-200">
      <td class="px-4 py-3 text-[1rem] font-semibold">Total</td>
   
      <td class="px-4 py-3 text-[1rem] text-center">
        <span class="revenue-kindle-monthly font-semibold">${totalDailyRevenue}</span>
      </td>
      <td class="px-4 py-3 text-[1rem] text-center">
        <span class="revenue-kindle-monthly font-semibold">${totalMonthlyRevenue}</span>
      </td>
    </tr>
  `;

        console.log("Total Daily Sales:", totalDailySales);
        console.log("Total Monthly Sales:", totalMonthlySales);
        console.log("Total Daily Revenue:", totalDailyRevenue);
        console.log("Total Monthly Revenue:", totalMonthlyRevenue);

        enableButton();
        hideLoader();
        showResultBox();
        showSearchBox();
      };
    </script>
  </body>
</html>
