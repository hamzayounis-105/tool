<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>query Sales Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Poppins:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      .poppins {
        font-family: "Poppins", sans-serif;
      }
      body {
        font-family: "Open Sans", sans-serif;
        color: #000;
        padding: 0;
        margin: 0;
      }
      [data-title]:hover::after {
        content: attr(data-title);
        font-family: "Open Sans", sans-serif;
        background-color: #ffc451;
        color: #000;
        padding: 0.7rem;
        width: 200px;
        position: absolute;
        z-index: 1000;
        line-height: 121%;
        font-size: 0.65rem;
        border-radius: 0.5rem;
        transform: translateX(0.5rem) translateY(-50%);
      }

      @media (max-width: 480px) {
        [data-title]:hover::after {
          right: 0;
          transform: translateX(-50%) translateY(-50%);
          left: 50%;
        }
      }
    </style>
  </head>
  <body>
    <div class="flex flex-col items-center justify-center w-full">
      <div class="w-[90%] sm:w-[80%] mt-2">
        <h2
          class="poppins my-4 text-[1.4rem] sm:text-[1.9rem] font-semibold text-[#FFC451]"
        >
          Buch-Wert-Rechner
        </h2>
        <p
          class="poppins my-6 text-[0.9rem] sm:text-[1rem] text-[#303030] leading-[121%] sm:text-justify text-left"
        >
          Mit unserem Buch-Wert-Rechner kannst Du ganz einfach den ungefähren
          Wert Deines Buchprojekts berechnen. Basierend auf dem Buchtyp, dem
          durchschnittlichen Verkaufspreis, den Gewinnen und der Dauer der
          regelmäßigen Einnahmen, zeigt Dir unser Tool den geschätzten Wert in
          Euro an. Gib einfach die entsprechenden Werte in die Felder ein, und
          unser Tool berechnet den Wert interaktiv und sofort. Beachte bitte,
          dass das Ergebnis lediglich einen Schätzwert zur Orientierung
          darstellt. Der tatsächliche Wert kann von verschiedenen Faktoren
          abhängen, einschließlich Marktbedingungen und individuellen
          Verkaufsstrategien. Falls Du spezielle Wünsche hast, Fehler entdeckst
          oder sonstige Anliegen hast, zögere bitte nicht, uns zu kontaktieren.
          Wir sind stets bemüht, unsere Tools zu verbessern und Deine
          Bedürfnisse bestmöglich zu erfüllen. Nutze hierfür bitte unser
          <a
            href="https://ghostwritery.de/kontakt/"
            class="text-[#FFC451] hover:underline"
            >Kontaktformular</a
          >. Wir freuen uns auf Deine Nachricht!
        </p>
      </div>
    </div>

    <!-- Section: query Input and Book Image -->
    <div class="container mx-auto p-6 lg:p-12 w-screen">
      <div class="flex w-full flex-col items-center justify-center -mx-4">
        <!-- query Input and Book Image -->
        <section class="w-full lg:w-[50%] p-4" id="searchBox">
          <div class="bg-white rounded-lg p-6 h-full shadow-md">
            <h2 class="text-xl font-semibold mb-4">Enter search query</h2>
            <div class="relative">
              <input
                type="text"
                id="query_input"
                class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#FFC451]"
                placeholder="Computer Programming"
              />
              <button
                onclick="fetchTopTenPage()"
                class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"
              >
                <i class="fas fa-search text-[#FFC451]"></i>
              </button>
            </div>
            <p id="warn" class="text-red-500 text-sm mt-2"></p>
          </div>
        </section>

        <section
          class="w-full lg:w-[50%] p-6 flex flex-col items-center justify-center hidden"
          id="loaderBox"
        >
          <img
            src="https://ghostwritery.de/wp-content/uploads/2024/08/Autoren-Tool-Konkurrenz-Analyse-load-icon.gif"
            alt="Loading animation"
            class="mb-4"
          />
          <p class="text-md text-[#e7a82e]" id="currentProcess">
            Process has started...
          </p>
        </section>

        <section class="w-full p-4 hidden" id="resultBox">
          <!-- <div
            class="flex flex-col lg:flex-row gap-5 justify-center items-stretch p-6 h-full"
          >
            <div
              class="bg-gray-50 flex flex-col justify-center rounded-lg w-full lg:w-1/2 p-4 shadow-md"
            >
              <h2 class="text-xl font-semibold mb-4">Estimated Sales</h2>
              <table class="w-full table-auto">
                <thead>
                  <tr class="border-gray-200">
                    <th
                      class="px-4 py-3 text-[1rem] font-medium text-start font-semibold"
                    >
                      Book Type
                    </th>
                    <th class="px-4 py-3 text-[1rem] font-medium font-semibold">
                      Daily Sales
                    </th>
                    <th class="px-4 py-3 text-[1rem] font-medium font-semibold">
                      Monthly Sales
                    </th>
                  </tr>
                </thead>
                <tbody class="tbodySale"></tbody>
              </table>
            </div>

            <div
              class="bg-gray-50 rounded-lg w-full lg:w-1/2 p-4 shadow-md flex flex-col justify-center"
            >
              <h2 class="text-xl font-semibold mb-4">Estimated Revenue</h2>
              <table class="w-full table-auto">
                <thead>
                  <tr class="border-gray-200">
                    <th
                      class="px-4 py-3 text-[1rem] font-medium text-start font-semibold"
                    >
                      Book Type
                    </th>
                    <th class="px-4 py-3 text-[1rem] font-medium font-semibold">
                      Daily Revenue
                    </th>
                    <th class="px-4 py-3 text-[1rem] font-medium font-semibold">
                      Monthly Revenue
                    </th>
                  </tr>
                </thead>
                <tbody class="tbodyRev"></tbody>
              </table>
            </div>
          </div> -->
        </section>
      </div>
    </div>
    <div class="flex flex-col items-center justify-center w-full">
      <div class="w-[90%] md:w-[80%] mt-2 mb-5">
        <h2
          class="poppins my-4 text-[1.3rem] sm:text-[1.5rem] font-semibold text-[#FFC451]"
        >
          Beispiel zur Nutzung des Tools „Konkurrenzanalyse"
        </h2>
        <p
          class="poppins my-6 text-[0.9rem] sm:text-[1rem] text-[#303030] leading-[121%] sm:text-justify text-left"
        >
          Um das Tool optimal zu nutzen, folge diesen Schritten:
        </p>
        <h3
          class="poppins my-4 text-[1.3rem] sm:text-[1.5rem] font-semibold text-[#FFC451]"
        >
          Schritte zur Nutzung:
        </h3>
        <ul class="ml-5 list-decimal poppins text-[0.9rem]">
          <li class="leading-[121%] py-1">
            <b>Bestseller-Rang eingeben:</b> Trage den aktuellen Bestseller-Rang
            des Konkurrenzbuches auf Amazon in das entsprechende Feld ein. Den
            Bestseller-Rang findest Du auf der Produktseite des Buches unter den
            Produktdetails.
          </li>
          <li class="leading-[121%] py-1">
            <b>Buchtyp auswählen:</b> Nutze das Dropdown-Menü, um den Typ des
            Konkurrenzbuches festzulegen. Die Optionen sind „eBook“,
            „Taschenbuch“ und „Hardcover“.
          </li>
          <li class="leading-[121%] py-1">
            <b>Berechnen:</b> Klicke auf den „Berechnen“-Button, um die
            geschätzten Verkaufszahlen zu erhalten.
          </li>
          <li class="leading-[121%] py-1">
            <b>Ergebnisse beobachten:</b> Das Tool zeigt Dir automatisch die
            geschätzten Verkaufszahlen pro Tag und pro Monat an, basierend auf
            Deinen Eingaben.
          </li>
        </ul>
        <h3
          class="poppins my-4 text-[1.3rem] sm:text-[1.5rem] font-semibold text-[#FFC451]"
        >
          Hinweise:
        </h3>
        <ul class="ml-5 list-decimal poppins text-[0.9rem]">
          <li class="leading-[121%] py-1">
            Die angezeigten Werte sind Schätzwerte und dienen lediglich zur
            Orientierung.
          </li>
        </ul>
        <p
          class="poppins my-6 text-[0.9rem] sm:text-[1rem] text-[#303030] leading-[121%] sm:text-justify text-left"
        >
          Falls Du spezielle Wünsche hast, Fehler entdeckst oder sonstige
          Anliegen hast, zögere bitte nicht, uns zu kontaktieren. Wir sind stets
          bemüht, unsere Tools zu verbessern und Deine Bedürfnisse bestmöglich
          zu erfüllen. Nutze hierfür bitte unser Kontaktformular. Wir freuen uns
          auf Deine Nachricht!
        </p>

        <h2
          class="poppins my-4 text-[1.3rem] sm:text-[1.5rem] font-semibold text-[#FFC451]"
        >
          Dankeschön
        </h2>
        <p
          class="poppins my-6 text-[0.9rem] sm:text-[1rem] text-[#303030] leading-[121%] sm:text-justify text-left"
        >
          Wir möchten uns herzlich bei allen Kunden bedanken, die bei der
          Erstellung dieses Tools mitgewirkt haben. Eure wertvollen
          Rückmeldungen und Anregungen haben uns geholfen, dieses Werkzeug noch
          besser auf Eure Bedürfnisse abzustimmen. Vielen Dank für Eure
          Unterstützung und das Vertrauen in unsere Dienstleistungen!
        </p>
      </div>
    </div>
    <script src="https://unpkg.com/axios@1.6.7/dist/axios.min.js"></script>
    <script>
      document
        .getElementById("query_input")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            fetchTopTenPage();
          }
        });

      const WARNING_TEXT = document.getElementById("warn");
      const query_input = document.getElementById("query_input");
      // const TBODY_REV = document.querySelector(".tbodyRev");
      // const TBODY_SALE = document.querySelector(".tbodySale");
      // const DUMMY_REVENUE = document.querySelectorAll(".dummyRevenue");
      const RESULT_DAILY = document.querySelector("#result-daily");
      const RESULT_MONTHLY = document.querySelector("#result-monthly");
      const RESULT_BOX = document.getElementById("resultBox");
      const LOADER_BOX = document.getElementById("loaderBox");
      const SEARCH_BOX = document.getElementById("searchBox");
      const CURRENT_PROCESS = document.getElementById("currentProcess");
      const audiobookTypes = [
        "Hörbuch",
        "Audiobook",
        "Audio Book",
        "Audible",
        "Audible Hörbuch",
        "Audible Audiobook",
        "Audible Audio Book",
        "MP3-CD",
        "Audio CD",
        "Audio",
        "CD",
        "MP3",
        "Digital Audiobook",
        "Downloadable Audiobook",
        "Streaming Audiobook",
        "Unabridged Audiobook",
        "Abridged Audiobook",
        "Audio Cassette",
        "Cassette",
        "Compact Disc",
        "Digital Audio",
        "Digital Download",
        "Playaway",
        "Audio MP3",
        "Audio Download",
        "Audio Streaming",
        "Audio Playaway",
        "Audio Digital",
        "Audio MP3-CD",
        "Audio MP3 CD",
        "Audio MP3 Disc",
        "Audio MP3 Download",
        "Audio MP3 Streaming",
        "Audio MP3 Playaway",
        "Audio MP3 Digital",
        "Audio-CD",
      ];
      const totalTargetIds = 10;

      // let bookCounter = 0;
      const toggleVisibility = (element, show) => {
        if (!element) {
          console.error("Element not found");
          return;
        }
        if (show) {
          if (element.classList.contains("hidden")) {
            element.classList.remove("hidden");
          }
        } else {
          if (!element.classList.contains("hidden")) {
            element.classList.add("hidden");
          }
        }
      };

      const showLoader = () => toggleVisibility(LOADER_BOX, true);
      const hideLoader = () => toggleVisibility(LOADER_BOX, false);
      const showResultBox = () => toggleVisibility(RESULT_BOX, true);
      const hideResultBox = () => toggleVisibility(RESULT_BOX, false);
      const showSearchBox = () => toggleVisibility(SEARCH_BOX, true);
      const hideSearchBox = () => toggleVisibility(SEARCH_BOX, false);

      const calculateSellingAmountPerDay = (sellerRank) => {
        let sellingAmountPerDay = 0;
        if (sellerRank >= 1 && sellerRank <= 5)
          sellingAmountPerDay = Math.round(
            ((230 - 370) / 4) * (sellerRank - 1) + 370
          );
        else if (sellerRank >= 6 && sellerRank <= 10)
          sellingAmountPerDay = Math.round(
            ((180 - 230) / 5) * (sellerRank - 5) + 230
          );
        else if (sellerRank >= 11 && sellerRank <= 20)
          sellingAmountPerDay = Math.round(
            ((120 - 180) / 10) * (sellerRank - 10) + 180
          );
        else if (sellerRank >= 21 && sellerRank <= 35)
          sellingAmountPerDay = Math.round(
            ((90 - 120) / 15) * (sellerRank - 20) + 120
          );
        else if (sellerRank >= 36 && sellerRank <= 50)
          sellingAmountPerDay = Math.round(
            ((80 - 90) / 15) * (sellerRank - 35) + 90
          );
        else if (sellerRank >= 51 && sellerRank <= 100)
          sellingAmountPerDay = Math.round(
            ((50 - 80) / 50) * (sellerRank - 50) + 80
          );
        else if (sellerRank >= 101 && sellerRank <= 200)
          sellingAmountPerDay = Math.round(
            ((33 - 50) / 100) * (sellerRank - 100) + 50
          );
        else if (sellerRank >= 201 && sellerRank <= 500)
          sellingAmountPerDay = Math.round(
            ((20 - 33) / 300) * (sellerRank - 200) + 33
          );
        else if (sellerRank >= 501 && sellerRank <= 1000)
          sellingAmountPerDay = Math.round(
            ((13 - 20) / 500) * (sellerRank - 500) + 20
          );
        else if (sellerRank >= 1001 && sellerRank <= 5000)
          sellingAmountPerDay = Math.round(
            ((5 - 13) / 4000) * (sellerRank - 1000) + 13
          );
        else if (sellerRank >= 5001 && sellerRank <= 10000)
          sellingAmountPerDay = Math.round(
            ((3 - 5) / 5000) * (sellerRank - 5000) + 5
          );
        else if (sellerRank >= 10001 && sellerRank <= 50000)
          sellingAmountPerDay = Math.round(
            ((1 - 3) / 40000) * (sellerRank - 10000) + 3
          );
        else if (sellerRank >= 50001 && sellerRank <= 100000)
          sellingAmountPerDay = Math.round(
            ((1 - 1) / 50000) * (sellerRank - 50000) + 1
          );
        else if (sellerRank > 100000) sellingAmountPerDay = "No Sales";
        return sellingAmountPerDay;
      };

      const getAllBookIds = (doc) => {
        const typesButtons = doc.querySelectorAll(
          ".a-button-toggle .a-button-inner a"
        );
        const bookIds = [];
        typesButtons.forEach((button) => {
          const href = button.getAttribute("href");
          if (href && !href.includes("javascript:void(0)")) {
            const match = href.match(/\/dp\/([A-Z0-9]{10})/);
            if (match) {
              bookIds.push(match[1]);
            }
          }
        });
        return bookIds;
      };
      const getBookPagesCount = (doc) => {
        const pagesCount = doc.querySelector(
          "#rpi-attribute-book_details-fiona_pages .rpi-attribute-value"
        );
        console.log(pagesCount);
        if (pagesCount) {
          return parseInt(pagesCount.textContent);
        } else {
          const pageCount2 = doc.querySelector(
            "#rpi-attribute-book_details-ebook_pages .rpi-attribute-value"
          );
          if (pageCount2) {
            return parseInt(pageCount2.textContent);
          } else {
            return 0;
          }
        }
      };
      const getBookTitle = (doc) => {
        let bookTitle = doc.querySelector("#productTitle");
        if (bookTitle) {
          return bookTitle.textContent.trim();
        }
        return "";
      };

      const getSelectedType = (doc) => {
        let selectedType2 = doc.querySelector(
          ".a-button-selected .a-button-inner .a-button-text .slot-title .audible_mm_title span span:nth-of-type(2)"
        );
        // console.log(selectedType2);
        if (selectedType2) {
          let bookType = selectedType2.textContent.trim();

          return bookType;
        }
        let selectedType = doc.querySelector(
          ".a-button-selected .a-button-inner .a-button-text .slot-title"
        );
        let bookType = selectedType ? selectedType.textContent.trim() : "";

        return bookType;
      };

      const getBookPrice = (doc) => {
        const type2 = doc.querySelector(".a-icon-kindle-unlimited");
        if (type2) {
          let bookPrice = doc.querySelector(".a-color-price").innerText;
          let priceToPay = doc.querySelector(".priceToPay .a-offscreen");
          const AreaCurrent = doc.querySelector(
            '[aria-current="page"] .slot-price span'
          );
          // console.log(AreaCurrent);

          const kindlePrice = doc.querySelector("#kindle-price");
          if (kindlePrice) {
            if (kindlePrice) {
              bookPrice = kindlePrice.innerText
                .replace(",", ".")
                .replace("€", "")
                .trim();
              return bookPrice;
            } else {
              bookPrice = 0;
              return bookPrice;
            }
          } else if (AreaCurrent) {
            bookPrice = AreaCurrent.innerText
              .replace(",", ".")
              .replace("€", "")
              .trim();
            return bookPrice;
          }
          return bookPrice;
        }

        let bookPrice = doc.querySelector(".a-color-price").innerText;
        bookPrice = bookPrice.replace(",", ".").replace("€", "").trim();
        return bookPrice;
      };
      const correctSellerLevel = (value) => {
        const sellerLevel = value.replace(".", "");
      };
      const getSellerLevel = (targetPageCode) => {
        let rankMatch = targetPageCode.match(
          /Amazon Bestseller-Rang: <\/span> Nr\. ([\d.,]+)/
        );
        if (rankMatch) {
          return rankMatch[1].replace(/\./g, "");
        } else {
          rankMatch = targetPageCode.match(
            /<span>Nr\. ([\d.,]+) in Audible Hörbücher &amp; Originals/
          );
          if (rankMatch) {
            // console.log(rankMatch);
            // console.log(rankMatch[1].replace(/\./g, ""));
            // console.log(rankMatch[1]);
            return rankMatch[1].replace(/\./g, "");
          }
        }
        return null;
      };

      const fetchPage = async (url) => {
        try {
          const response = await axios.get(url);
          {
            if (response.status !== 200) {
              // throw new Error("Network response was not ok.");
              console.log("Error fetching the page of a ID" + url);
              console.log("Error fetching the page:");
              WARNING_TEXT.textContent =
                "An error occurred while fetching the page.";
              return null;
            }
          }
          if (
            response.data.includes(
              "Sorry, we just need to make sure you're not a robot. For best results, please make sure your browser is accepting cookies."
            )
          ) {
            console.log("Error fetching the page of a ID robot error" + url);
            WARNING_TEXT.textContent =
              "An error occurred while fetching the page.";
            return null;
          }
          return response.data;
        } catch (error) {
          hideLoader();
          showSearchBox();
          console.error("Error fetching the page:", error);
          WARNING_TEXT.textContent =
            "An error occurred while fetching the page.";
          return null;
        }
      };

      const fetchBookDetails = async (bookId) => {
        if (!bookId) {
          return null;
        }
        // bookCounter++;
        // CURRENT_PROCESS.textContent = "";
        const url = `https://makis.world/amazon/dp/${bookId}`;

        const targetPageCode = await fetchPage(url);
        if (!targetPageCode) {
          console.log(
            "Error fetching the page of a ID at targetpagecode" + url
          );
          return null;
        }

        const parser = new DOMParser();
        const doc = parser.parseFromString(targetPageCode, "text/html");

        const bookType = getSelectedType(doc);

        // if (bookType === "Hörbuch") {
        //   return null;
        // }
        let bookPrice = getBookPrice(doc);

        // bookPrice = parseFloat(bookPrice);
        const sellerLevel = getSellerLevel(targetPageCode);
        let bookPages = getBookPagesCount(doc);
        if (bookPages) {
          bookPages = parseInt(bookPages);
        } else {
          bookPages = 0;
        }
        let sellingAmountPerDay = calculateSellingAmountPerDay(sellerLevel);
        let bookName = getBookTitle(doc);
        let sellingAmountPerMonth = 0;
        if (sellingAmountPerDay !== "No Sales") {
          sellingAmountPerMonth = sellingAmountPerDay * 30;
        } else {
          sellingAmountPerMonth = "No Sales";
        }

        let dailyRevenue = 0;
        let monthlyRevenue = 0;
        if (
          !isNaN(bookPrice) &&
          sellingAmountPerDay !== "No Sales" &&
          !isNaN(sellingAmountPerMonth)
        ) {
          dailyRevenue = Math.round(bookPrice * sellingAmountPerDay);
          monthlyRevenue = Math.round(bookPrice * sellingAmountPerMonth);
        }
        if (audiobookTypes.includes(bookType)) {
          sellingAmountPerDay = "No Sales";
          sellingAmountPerMonth = "No Sales";
        }
        if (
          bookType != null &&
          bookType != "" &&
          bookType != undefined &&
          !audiobookTypes.includes(bookType) &&
          bookPrice != "0.00" &&
          bookPrice != "" &&
          bookPrice != 0
        ) {
          addBookTypetoArray(bookType);
          addBookPricetoArray(bookPrice);
          pushToSumAllDataOBJ({
            SbookType: bookType,
            SbookPrice: parseFloat(bookPrice),
          });
          console.log(bookType);
          console.log(bookPrice);
        }

        // console.log(sellingAmountPerDay);
        // console.log(sellingAmountPerMonth);
        return {
          bookName,
          bookId,
          bookType,
          bookPrice,
          sellerLevel,
          sellingAmountPerDay,
          sellingAmountPerMonth,
          dailyRevenue,
          monthlyRevenue,
          bookPages,
        };
      };
      let bookTypesArray = [];
      let bookPricesArray = [];
      let allBookSumData = [];
      const addBookTypetoArray = (bookType) => {
        if (bookType && !audiobookTypes.includes(bookType)) {
          bookTypesArray.push(bookType);
        }
      };

      const addBookPricetoArray = (bookPrice) => {
        if (bookPrice) {
          bookPricesArray.push(bookPrice);
        }
      };
      const pushToSumAllDataOBJ = (bookDataSum) => {
        const index = allBookSumData.findIndex(
          (book) => book.SbookType === bookDataSum.SbookType
        );
        if (index !== -1) {
          // If found, update the existing object
          allBookSumData[index] = {
            ...allBookSumData[index],

            SbookPrice:
              allBookSumData[index].SbookPrice + bookDataSum.SbookPrice, // Increment the counter
            SbookCounter: allBookSumData[index].SbookCounter + 1, // Increment the counter
          };
        } else {
          // If not found, push the new object
          bookDataSum = {
            ...bookDataSum,
            SbookCounter: 1,
          };
          allBookSumData.push(bookDataSum);
        }
      };
      const fetchTopTenPage = async () => {
        bookPricesArray = [];
        bookTypesArray = [];
        RESULT_BOX.innerHTML = "";
        const query = query_input.value.trim();
        if (query === "" || query === null) {
          WARNING_TEXT.textContent = "Please enter a valid query";
          return;
        }
        if (query.length < 3) {
          WARNING_TEXT.textContent = "Please enter at least 3 characters";
          return;
        }
        hideResultBox();
        hideSearchBox();
        showLoader();
        CURRENT_PROCESS.textContent = "Fetching the top 10 books...";
        const targetPageURL = `https://makis.world/amazon/s?k=${query}&i=stripbooks`;
        let totalBookData = [];
        try {
          const res = await axios.get(targetPageURL);
          if (res.status !== 200) {
            hideLoader();
            showResultBox();
            showSearchBox();
            console.log("Error fetching the page:");
            return;
          }
          const parser = new DOMParser();
          const doc = parser.parseFromString(res.data, "text/html");
          const topTenIds = getTopTenIds(doc);
          for (let i = 0; i < topTenIds.length; i++) {
            CURRENT_PROCESS.innerHTML = `Working on book number <b>${
              i + 1
            }</b>`;
            const bookData = await calculateDetails(topTenIds[i]);
            if (bookData) {
              totalBookData.push(bookData);
            }
            CURRENT_PROCESS.textContent = "";
          }
          RESULT_BOX.innerHTML += `
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Book Type</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Book Average Price</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              ${allBookSumData
                .map((book) => {
                  return `
                <tr>
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${
                    book.SbookType
                  }</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${(
                    book.SbookPrice / book.SbookCounter
                  ).toFixed(2)}</td>
                </tr>
                `;
                })
                .join("")}
            </tbody>
          </table>
          `;
          console.log(bookTypesArray);
          console.log(bookPricesArray);
          console.log(allBookSumData);
          console.log(totalBookData);
        } catch (error) {
          hideLoader();
          showResultBox();
          showSearchBox();
          return;
          console.error("Error fetching the page:", error);
          WARNING_TEXT.textContent =
            "An error occurred while fetching the page.";
        } finally {
          hideLoader();
          showResultBox();
          showSearchBox();
        }
      };

      const getTopTenIds = (doc) => {
        const bookIds = [];
        const bookList = doc.querySelectorAll(".s-result-item");
        let IDsCounter = 0;
        for (let book of bookList) {
          const bookId = book.getAttribute("data-asin");
          if (bookId) {
            if (IDsCounter !== totalTargetIds) {
              bookIds.push(bookId);
              IDsCounter++;
            } else {
              break;
            }
          }
        }
        return bookIds;
      };

      const calculateDetails = async (id) => {
        if (!id) {
          return;
        }
        // TBODY_REV.innerHTML = "";
        // TBODY_SALE.innerHTML = "";
        WARNING_TEXT.textContent = "";
        const firstBookDetails = await fetchBookDetails(id);
        if (!firstBookDetails) {
          WARNING_TEXT.textContent =
            "Failed to fetch details. Please check the query and try again.";
          return;
        }
        const url = `https://makis.world/amazon/dp/${id}`;
        const targetPageCode = await fetchPage(url);
        const parser = new DOMParser();
        const doc = parser.parseFromString(targetPageCode, "text/html");

        const remainingBookIds = getAllBookIds(doc);
        let remainingBookDetails = [];
        let totalDailySales = 0;
        let totalMonthlySales = 0;
        let totalDailyRevenue = 0;
        let totalMonthlyRevenue = 0;
        let remainingBookDetailsLength = remainingBookIds.length;
        if (
          firstBookDetails.sellingAmountPerDay !== "No Sales" &&
          !isNaN(firstBookDetails.sellingAmountPerMonth)
        ) {
          totalDailySales += firstBookDetails.sellingAmountPerDay;
          totalMonthlySales += firstBookDetails.sellingAmountPerMonth;
          totalDailyRevenue += firstBookDetails.dailyRevenue;
          totalMonthlyRevenue += firstBookDetails.monthlyRevenue;
        }
        while (remainingBookDetailsLength > 0) {
          remainingBookDetailsLength--;
          const bookDetails = await fetchBookDetails(
            remainingBookIds[remainingBookDetailsLength]
          );
          if (bookDetails) {
            remainingBookDetails.push(bookDetails);
            if (
              bookDetails.sellingAmountPerDay !== "No Sales" &&
              !isNaN(bookDetails.sellingAmountPerMonth)
            ) {
              totalDailySales += bookDetails.sellingAmountPerDay;
              totalMonthlySales += bookDetails.sellingAmountPerMonth;
              totalDailyRevenue += bookDetails.dailyRevenue;
              totalMonthlyRevenue += bookDetails.monthlyRevenue;
            }
          } else {
            console.log(
              "Error in retering the book details of ID" +
                remainingBookIds[remainingBookDetailsLength]
            );
          }
        }

        let allBooksData = [];

        // Filter out books with types included in audiobookTypes
        const filteredBookData = remainingBookDetails.filter(
          (book) => !audiobookTypes.includes(book.bookType)
        );

        // Ensure firstBookDetails is not included if its type is in audiobookTypes
        if (!audiobookTypes.includes(firstBookDetails.bookType)) {
          allBooksData = [firstBookDetails, ...filteredBookData];
        } else {
          allBooksData = [...filteredBookData];
        }
        let numberofPages = 0;
        for (let i = 0; i < allBooksData.length; i++) {
          const book = allBooksData[i];
          if (book.bookType == "Paperback" || book.bookType == "Taschenbuch") {
            numberofPages = book.bookPages;
            break;
          } else if (
            book.bookType == "Hardcover" ||
            book.bookType == "Gebunden"
          ) {
            numberofPages = book.bookPages;
            break;
          } else {
            numberofPages = "";
          }
        }

        console.log(allBooksData);
        let allBookLength = allBooksData.length;
        // console.log(allBookLength);
        RESULT_BOX.innerHTML += `
          <div class="flex flex-col gap-5 justify-center items-stretch p-6 h-full">
            <h2 class="text-2xl font-semibold mb-4 text-center">${allBooksData[0].bookName}</h2>
            <p>${numberofPages} Pages</p>
            <div class="flex flex-col lg:flex-row gap-5">
              <div class="bg-gray-50 flex flex-col justify-center rounded-lg w-full lg:w-1/2 p-4 shadow-md">
                <h2 class="text-xl font-semibold mb-4 text-center">Estimated Sales</h2>
                <table class="w-full table-auto">
                  <thead>
                    <tr class="border-gray-200">
                      <th class="px-4 py-3 text-[1rem] font-medium text-start font-semibold">Book Type</th>
                      <th class="px-4 py-3 text-[1rem] font-medium font-semibold">Daily Sales</th>
                      <th class="px-4 py-3 text-[1rem] font-medium font-semibold">Monthly Sales</th>
                    </tr>
                  </thead>
                  <tbody class="tbodySale" id="${allBooksData[0].bookId}"></tbody>
                </table>
              </div>
              <div class="bg-gray-50 rounded-lg w-full lg:w-1/2 p-4 shadow-md flex flex-col justify-center">
                <h2 class="text-xl font-semibold mb-4 text-center">Estimated Revenue</h2>
                <table class="w-full table-auto">
                  <thead>
                    <tr class="border-gray-200">
                      <th class="px-4 py-3 text-[1rem] font-medium text-start font-semibold">Book Type</th>
                      <th class="px-4 py-3 text-[1rem] font-medium font-semibold">Daily Revenue</th>
                      <th class="px-4 py-3 text-[1rem] font-medium font-semibold">Monthly Revenue</th>
                    </tr>
                  </thead>
                  <tbody class="tbodyRev" id="${allBooksData[0].bookName}"></tbody>
                </table>
              </div>
            </div>
          </div>
        `;

        const saleID = document.getElementById(allBooksData[0].bookId);
        const revID = document.getElementById(allBooksData[0].bookName);
        while (allBookLength > 0) {
          allBookLength--;

          let rowSale = `
            <tr class="border-gray-200">
              <td class="px-4 py-3 text-[1rem] font-medium">${
                allBooksData[allBookLength].bookType
              }</td>
              <td class="px-4 py-3 text-[1rem] text-center">
                <span class="revenue-kindle-monthly">${allBooksData[
                  allBookLength
                ].sellingAmountPerDay.toLocaleString("de-DE")}</span>
              </td>
              <td class="px-4 py-3 text-[1rem] text-center">
                <span class="revenue-kindle-monthly">${allBooksData[
                  allBookLength
                ].sellingAmountPerMonth.toLocaleString("de-DE")}</span>
              </td>
            </tr>
          `;
          saleID.innerHTML += rowSale;

          let rowRev = `
            <tr class="border-gray-200">
              <td class="px-4 py-3 text-[1rem] font-medium">${
                allBooksData[allBookLength].bookType
              }</td>
              <td class="px-4 py-3 text-[1rem] text-center">
                <span class="revenue-kindle-monthly">${allBooksData[
                  allBookLength
                ].dailyRevenue.toLocaleString("de-DE")}</span>€
              </td>
              <td class="px-4 py-3 text-[1rem] text-center">
                <span class="revenue-kindle-monthly">${allBooksData[
                  allBookLength
                ].monthlyRevenue.toLocaleString("de-DE")}</span>€
              </td>
            </tr>
          `;
          revID.innerHTML += rowRev;
        }

        saleID.innerHTML += `
          <tr class="border-gray-200">
            <td class="px-4 py-3 text-[1rem] font-semibold">Total</td>
            <td class="px-4 py-3 text-[1rem] text-center">
              <span class="revenue-kindle-monthly font-semibold">${totalDailySales.toLocaleString(
                "de-DE"
              )}</span>
            </td>
            <td class="px-4 py-3 text-[1rem] text-center">
              <span class="revenue-kindle-monthly font-semibold">${totalMonthlySales.toLocaleString(
                "de-DE"
              )}</span>
            </td>
          </tr>
        `;

        revID.innerHTML += `
          <tr class="border-gray-200">
            <td class="px-4 py-3 text-[1rem] font-semibold">Total</td>
            <td class="px-4 py-3 text-[1rem] text-center">
              <span class="revenue-kindle-monthly font-semibold">${totalDailyRevenue.toLocaleString(
                "de-DE"
              )}</span>€
            </td>
            <td class="px-4 py-3 text-[1rem] text-center">
              <span class="revenue-kindle-monthly font-semibold">${totalMonthlyRevenue.toLocaleString(
                "de-DE"
              )}</span>€
            </td>
          </tr>
        `;

        CURRENT_PROCESS.textContent = "Process has started...";
        return allBooksData;
      };
    </script>
  </body>
</html>
